// ---------------- Data fetch (Binance via CORS proxy) -----------------
const proxy = "https://api.allorigins.win/raw?url=";

async function fetchMarketChart(days = 1, interval = '1h') {
  let limit = 100;
  if (interval === '1d') {
    limit = Math.min(days, 500);
  }

  const url = proxy + encodeURIComponent(
    `https://api.binance.com/api/v3/klines?symbol=BTCUSDT&interval=${interval}&limit=${limit}`
  );

  const res = await fetch(url);
  if (!res.ok) throw new Error('Failed to fetch Binance data');
  const raw = await res.json();
  const prices = raw.map(r => [ +r[0], parseFloat(r[4]) ]);
  return { prices };
}

async function fetchSimplePrice() {
  const url = proxy + encodeURIComponent("https://api.binance.com/api/v3/ticker/24hr?symbol=BTCUSDT");
  const res = await fetch(url);
  if (!res.ok) throw new Error('Failed to fetch Binance spot');
  const d = await res.json();
  return { price: +d.lastPrice, change: +d.priceChangePercent };
}
